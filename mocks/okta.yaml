# Mock server config for Okta-style API (development/testing).
# Run: hel mock-server mocks/okta.yaml
# Then point hel.yaml sources at http://127.0.0.1:<port> (port printed to stderr).
#
# Response order: more specific rules first. Three cases:
# 1. Next page: after=cursor1 (cursor known from Link header)
# 2. First page with since: since=<anything> (time-based initial fetch)
# 3. Initial request: no query params (cursor not known yet)

endpoint: "/api/v1/logs"
# bind: "127.0.0.1:0"   # default: pick port

responses:
  - match:
      query:
        after: "cursor1"
    response:
      status: 200
      headers:
        Content-Type: "application/json"
      body: '[]'

  - match:
      query:
        since: "*"
    response:
      status: 200
      headers:
        Content-Type: "application/json"
        Link: '</api/v1/logs?after=cursor1>; rel="next"'
      body: '[{"uuid":"a1","published":"2024-01-15T12:00:00Z","eventType":"user.session.start"}]'

  # Initial request: no cursor (no query params or GET /api/v1/logs only)
  - match:
      query: {}
    response:
      status: 200
      headers:
        Content-Type: "application/json"
        Link: '</api/v1/logs?after=cursor1>; rel="next"'
      body: '[{"actor":{"alternateId":"user@example.com","detailEntry":null,"displayName":"Test User","id":"00u00000000000000000","type":"User"},"authenticationContext":{"authenticationProvider":null,"authenticationStep":0,"credentialProvider":null,"credentialType":null,"externalSessionId":"sess000000000000000000000000","interface":null,"issuer":null,"rootSessionId":"sess000000000000000000000000"},"client":{"device":"unknown","geographicalContext":null,"id":null,"ipAddress":"192.0.2.1","userAgent":{"browser":"unknown","os":"unknown","rawUserAgent":"unknown"},"zone":"null"},"debugContext":{"debugData":{"dtHash":"9e68c8ed088551b9ad26f3f00224afb4e3811819aa2fa0682080bcb45e367300","operationRateLimitScopeType":"token","operationRateLimitSecondsToReset":"43","operationRateLimitSubtype":"ssws_token","operationRateLimitThreshold":"60","operationRateLimitTimeSpan":"1","operationRateLimitTimeUnit":"MINUTES","operationRateLimitType":"web_request","requestId":"req000000000000000000000000000000","requestUri":"/api/v1/logs","url":"/api/v1/logs?after=1769726376173_1"}},"device":null,"displayMessage":"This API token has made too many requests","eventType":"system.operation.rate_limit.violation","legacyEventType":null,"outcome":null,"published":"2026-01-29T22:42:35.199Z","request":{"ipChain":[{"geographicalContext":null,"ip":"192.0.2.1","source":null,"version":"V4"}]},"securityContext":{"asNumber":null,"asOrg":null,"domain":null,"isProxy":null,"isp":null},"severity":"WARN","target":[{"alternateId":null,"detailEntry":null,"displayName":null,"id":"00000000-0000-0000-0000-000000000001","type":"Bucket UUID"},{"alternateId":"unknown","detailEntry":null,"displayName":"hel","id":"00T00000000000000000","type":"Token"}],"transaction":{"detail":{"requestApiTokenId":"00T00000000000000000","rootApiTokenId":"00T00000000000000000"},"id":"req000000000000000000000000000000","type":"WEB"},"uuid":"evt00000000-0000-0000-0000-000000000001","version":"0"}]'
